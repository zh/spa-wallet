(this["webpackJsonpspa-wallet"]=this["webpackJsonpspa-wallet"]||[]).push([[0],{19:function(t,e,n){"use strict";(function(t){var a=n(18),s=n(16),r=function(){function e(){Object(a.a)(this,e)}return Object(s.a)(e,null,[{key:"hashToTxid",value:function(e){var n=t.from(e).toString("hex"),a=new Uint8Array(n.match(/.{1,2}/g).map((function(t){return parseInt(t,16)}))).reverse();return t.from(a).toString("hex")}},{key:"outpointToKey",value:function(n,a){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.alloc(4);return r.writeUInt32BE(a),s?t.from(n).toString("hex")+r.toString("hex"):e.hashToTxid(n)+r.toString("hex")}},{key:"keyToOutpointString",value:function(e){var n=e.slice(0,64),a=e.slice(64,72),s=t.from(a,"hex");return"".concat(n,":").concat(s.readUInt32BE(0))}}]),e}();r.sleep=function(t){return new Promise((function(e){return setTimeout(e,t)}))},e.a=r}).call(this,n(2).Buffer)},195:function(t,e,n){"use strict";(function(t){var a,s=n(25),r=n(0),i=n(4),o=n.n(i),c=n(11),u=n(18),l=n(16),d=n(83),h=n(201),p=n(50),f=n(202),b=n(200),x=n(1),m=n(85),O=(n(214),n(196)),g=n(197),j=n.n(g),v=n(41),T=n.n(v),k=n(9),S=n(49),y=n(8),w=n(59),A=n(203),I=n(19);!function(t){t.LOW_BCH_INPUTS="insufficient bch inputs",t.LOW_SLP_INPUTS="insufficient slp inputs",t.INVALID_OUTPUT_ADDRESS="invalid address",t.NON_SLP_ADDRESS="address isn't slp format",t.INVALID_OUTPUT_AMOUNT="invalid amount",t.BELOW_DUST_LIMIT="output is lower than dust limit",t.ZERO_SLP_OUTPUT="must have slp output > 0",t.TOO_MANY_SLP_DECIMAL_PLACES="too many decimal places for this slp token"}(a||(a={}));var C={border:"1px solid grey",marginLeft:"auto",marginRight:"auto"},W=["bchd.fountainhead.cash","bchd-mainnet.electroncash.de","bchd.imaginary.cash/proxy","bchd.greyh.at:8335","localhost:8335"],_=function(e){Object(f.a)(i,e);var n=Object(b.a)(i);function i(t){var e;return Object(u.a)(this,i),(e=n.call(this,t)).domWallet=new A.a(Object(d.a)(e)),e.mounted=!1,e.copyToClipboard=function(t){t.preventDefault(),navigator.clipboard.writeText(e.state.address),e.setState({showCopySuccess:!0})},e.validateAddOutput=function(){T.a.isValidAddress(e.state.outputAddressValue)?(e.state.txnValidationErrors.delete(a.INVALID_OUTPUT_ADDRESS),"bch"===e.state.selectedSlpTokenId||T.a.isSlpAddress(e.state.outputAddressValue)?"bch"!==e.state.selectedSlpTokenId&&e.state.txnValidationErrors.delete(a.NON_SLP_ADDRESS):e.state.txnValidationErrors.add(a.NON_SLP_ADDRESS)):(e.state.txnValidationErrors.add(a.INVALID_OUTPUT_ADDRESS),e.state.txnValidationErrors.delete(a.NON_SLP_ADDRESS));try{Object(k.Big)(e.state.outputAmountValue),e.state.txnValidationErrors.delete(a.INVALID_OUTPUT_AMOUNT)}catch(p){e.state.txnValidationErrors.add(a.INVALID_OUTPUT_AMOUNT)}var t=e.state.currentTxn;if("bch"===e.state.selectedSlpTokenId)if(e.state.outputAmountValue&&Object(k.Big)(e.state.outputAmountValue).lt(546)?e.state.txnValidationErrors.add(a.BELOW_DUST_LIMIT):e.state.txnValidationErrors.delete(a.BELOW_DUST_LIMIT),e.state.outputAmountValue){var n=Array.from(e.domWallet.Wallet.BchCoins).reduce((function(t,e,n){return t.add(e[1].satoshis)}),Object(k.Big)(0));t.Outputs.reduce((function(t,e,n){return t.add(e[0].satoshis)}),Object(k.Big)(0)).add(e.state.outputAmountValue).gt(n)?e.state.txnValidationErrors.add(a.LOW_BCH_INPUTS):e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS)}else e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS);else if(e.state.txnValidationErrors.delete(a.BELOW_DUST_LIMIT),e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS),e.state.outputAmountValue){var s=e.getTokenAmount(new k.Big(e.state.outputAmountValue),e.state.selectedSlpTokenId);e.state.outputAmountValue&&s.lt(1)?e.state.txnValidationErrors.add(a.ZERO_SLP_OUTPUT):e.state.txnValidationErrors.delete(a.ZERO_SLP_OUTPUT);var r=e.state.selectedSlpTokenId,i=e.domWallet.Wallet.SlpCoins.get(r),o=Array.from(i).reduce((function(t,e,n){return t.add(e[1].amount)}),Object(k.Big)(0)),c=e.state.currentTxn.SlpChangeOutput?e.state.currentTxn.SlpChangeOutput.amount:0;t.SlpOutputs.reduce((function(t,e,n){return t.add(e)}),Object(k.Big)(0)).add(s).sub(c).gt(o)?e.state.txnValidationErrors.add(a.LOW_SLP_INPUTS):e.state.txnValidationErrors.delete(a.LOW_SLP_INPUTS);var u=e.state.currentTxn.SlpChangeOutput?w.a:0,l=42+9*t.SlpOutputs.length,d=Array.from(e.domWallet.Wallet.BchCoins).reduce((function(t,e,n){return t.add(e[1].satoshis)}),Object(k.Big)(0)),h=t.BchChangeOutput?t.BchChangeOutput.amount:0;t.Outputs.reduce((function(t,e,n){return t.add(e[0].satoshis)}),Object(k.Big)(0)).add(w.a).add(u).add(l).sub(h).gt(d)?e.state.txnValidationErrors.add(a.LOW_BCH_INPUTS):e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS),s.lt(1)?e.state.txnValidationErrors.add(a.TOO_MANY_SLP_DECIMAL_PLACES):e.state.txnValidationErrors.delete(a.TOO_MANY_SLP_DECIMAL_PLACES)}else e.state.txnValidationErrors.delete(a.LOW_SLP_INPUTS),e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS),e.state.txnValidationErrors.delete(a.ZERO_SLP_OUTPUT),e.state.txnValidationErrors.delete(a.TOO_MANY_SLP_DECIMAL_PLACES);return e.state.txnValidationErrors.size>0&&e.forceUpdate(),e.state.txnValidationErrors.size},e.updateOutputAddress=function(t){T.a.isValidAddress(t.target.value)?e.setState({outputAddressValid:!0,outputAddressValue:t.target.value}):e.setState({outputAddressValid:!1,outputAddressValue:t.target.value})},e.updateSelectedToken=function(t){var n=t.target.value;n!==e.state.selectedSlpTokenId&&e.setState({currentTxn:new w.b(e.domWallet.Wallet)}),t.target.selectedIndex<e.domWallet.Wallet.TokenMetadata.size?e.setState({selectedSlpTokenId:n}):e.setState({selectedSlpTokenId:"bch"})},e.updateNodeUri=function(t){var n=t.target.value;W.includes(n)&&(e.domWallet.setNode(n),e.domWallet.Wallet.LoadInitialBalances(),e.domWallet.Wallet.Subscribe(),e.UpdateWalletUI())},e.currentNodeUri=function(){return e.domWallet.Storage.GetNode()||W[0]},e.updateOutputValue=function(t){try{Object(k.Big)(t.target.value)}catch(n){return void e.setState({outputAmountValid:!1,outputAmountValue:t.target.value})}Object(k.Big)(t.target.value).lt(546)?e.setState({outputAmountValid:!1,outputAmountValue:t.target.value}):e.setState({outputAmountValid:!0,outputAmountValue:t.target.value})},e.clearTransaction=function(){e.state.txnValidationErrors.clear(),e.setState({outputAddressValue:"",outputAmountValue:"",currentTxn:new w.b(e.domWallet.Wallet),selectedSlpTokenId:"bch"})},e.sendTransaction=Object(c.a)(o.a.mark((function t(){var n,a,s,i,c,u;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.state.currentTxn.SignTransaction((function(){return e.domWallet.Wallet.PrivateKey}));case 3:return n=t.sent,a=n.txnHex,s=n.fee,i=n.sendAmount,console.log(a),t.next=10,Object(m.b)("".concat(i," satoshis with fee: ").concat(s," satoshis?"),"Sending transaction");case 10:if(!t.sent){t.next=20;break}return c="https://explorer.bitcoin.com/bch/tx/",t.next=15,e.domWallet.Wallet.SendTransaction(a);case 15:return u=t.sent,t.next=18,Object(m.a)(Object(r.jsx)("a",{href:"".concat(c).concat(u),target:"_blank",rel:"noopener noreferrer",download:!0,children:u}),"Broadcasted");case 18:e.clearTransaction(),e.forceUpdate();case 20:t.next=26;break;case 22:return t.prev=22,t.t0=t.catch(0),t.next=26,Object(m.a)("Error: ".concat(t.t0.message));case 26:case"end":return t.stop()}}),t,null,[[0,22]])}))),e.setMaxAmount=function(){if("bch"===e.state.selectedSlpTokenId)e.setState({outputAmountValue:e.domWallet.Wallet.GetBchBalance().toFixed()});else{var t=e.domWallet.Wallet.GetSlpBalances().get(e.state.selectedSlpTokenId),n=e.getTokenAmount(t,e.state.selectedSlpTokenId,!0);e.setState({outputAmountValue:n.toFixed()})}},e.addOutput=function(){if(!(e.validateAddOutput()>0)){var t=T.a.toCashAddress(e.state.outputAddressValue),n=Object(k.Big)(e.state.outputAmountValue);switch(e.state.selectedSlpTokenId){case"bch":e.state.currentTxn.AddBchOutput(new y.Address(t),n.toNumber())?e.state.txnValidationErrors.delete(a.LOW_BCH_INPUTS):e.state.txnValidationErrors.add(a.LOW_BCH_INPUTS);break;default:var s=e.getTokenAmount(n,e.state.selectedSlpTokenId);e.state.currentTxn.AddSlpOutput(t,s,e.state.selectedSlpTokenId)}e.forceUpdate()}},e.importMnemonic=function(t){var n=t.target.value;if(n){e.setState({showCopySuccess:!1});try{e.domWallet.Wallet.UpdateMnemonic(n)}catch(a){console.log("invalid wif: ".concat(n))}e.setState({address:e.domWallet.Wallet.Address.toCashAddress(),showPrivKey:!1,showSlpAddressFormat:!1}),e.domWallet.Wallet.LoadInitialBalances()}},e.toggleAddrFormat=Object(c.a)(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({showCopySuccess:!1}),n=e.domWallet.Wallet.Address.toCashAddress(),e.state.showSlpAddressFormat||(n=T.a.toSlpAddress(n)),e.state.useMainnet||(n=T.a.toTestnetAddress(n)),t.next=6,e.setState({showSlpAddressFormat:!e.state.showSlpAddressFormat,address:n});case 6:case"end":return t.stop()}}),t)}))),e.toggleMnemonic=function(){e.setState({showPrivKey:!e.state.showPrivKey})},e.state={showPrivKey:!1,showSlpAddressFormat:!0,showCopySuccess:!1,address:T.a.toSlpAddress(e.domWallet.Wallet.Address.toCashAddress()),useMainnet:!0,checkingBalance:!0,showCoins:!1,showTxnInputs:!1,outputAddressValue:"",outputAddressValid:!1,outputAmountValue:"",outputAmountValid:!1,selectedSlpTokenId:"bch",slpOutputs:[],currentTxn:new w.b(e.domWallet.Wallet),txnValidationErrors:new Set},e}return Object(l.a)(i,[{key:"componentDidMount",value:function(){this.mounted=!0,this.domWallet.Wallet.LoadInitialBalances(),this.domWallet.Wallet.Subscribe()}},{key:"UpdateWalletUI",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var t=this;return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsxs)("header",{className:"App-header",children:[Object(r.jsx)("br",{}),Object(r.jsx)("a",{className:"App-link",href:"https://bch.info",target:"_blank",rel:"noopener noreferrer",children:Object(r.jsx)("img",{src:O.a,className:"App-logo",alt:"logo",width:"30%",height:"30%"})})]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("label",{htmlFor:"node",children:"Node: "}),Object(r.jsx)("select",{id:"node",value:this.currentNodeUri(),onChange:this.updateNodeUri,children:W.map((function(t){return Object(r.jsx)("option",{value:t,children:t},t)}))})]}),Object(r.jsx)("strong",{children:"Back up your funds with your seed or WIF!!!"}),Object(r.jsx)("br",{}),Object(r.jsxs)("button",{onClick:this.toggleMnemonic,children:[this.state.showPrivKey?"Hide":"Show"," Private Keys"]}),"\xa0\xa0",Object(r.jsx)("a",{href:"https://iancoleman.io/bip39/",target:"_blank",rel:"noopener noreferrer",children:"Generate Keys (BIP39)"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{hidden:!this.state.showPrivKey,children:["WIF or seed: ",Object(r.jsx)("input",{className:"App-private-keys",defaultValue:"".concat(this.domWallet.Wallet.Mnemonic?this.domWallet.Wallet.Mnemonic:this.domWallet.Wallet.Wif),onChange:this.importMnemonic}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{hidden:null===this.domWallet.Wallet.XPub,children:["Xpub:",Object(r.jsx)("br",{}),this.domWallet.Wallet.XPub]})]}),Object(r.jsx)("hr",{}),Object(r.jsxs)("div",{children:[Object(r.jsx)("strong",{children:"Your wallet address:"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{onClick:this.copyToClipboard,children:[Object(r.jsx)(j.a,{value:this.state.address}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("div",{className:"App-qr-text",children:this.state.address}),this.state.showCopySuccess&&Object(r.jsx)("div",{className:"App-qr-success",children:" (copied!) "})]}),Object(r.jsx)("br",{}),Object(r.jsxs)("button",{onClick:this.toggleAddrFormat,children:["Switch to ",this.state.showSlpAddressFormat?"cash":"slp","Addr format"]})]}),Object(r.jsx)("hr",{}),Object(r.jsxs)("div",{hidden:0===this.domWallet.Wallet.SlpCoins.size,children:[Object(r.jsx)("strong",{children:"Balances:"}),Object(r.jsx)("br",{}),Object(r.jsxs)("table",{style:C,children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"name"}),Object(r.jsx)("th",{children:"amount"}),Object(r.jsx)("th",{children:"type"})]})}),Object(r.jsxs)("tbody",{children:[Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:"BCH"}),Object(r.jsx)("td",{children:this.domWallet.Wallet.GetBchBalance().div(Math.pow(10,8)).toFixed(8)}),Object(r.jsx)("td",{children:"\xa0"})]},"bch-bal"),Array.from(this.domWallet.Wallet.GetSlpBalances()).map((function(e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:t.getTokenName(e[0])}),Object(r.jsx)("td",{children:t.getSlpAmountString(e[1],e[0])}),Object(r.jsx)("td",{children:t.getTokenTypeString(e[0])})]},"".concat(e[0],"-bal"))}))]})]})]}),Object(r.jsx)("br",{}),Object(r.jsx)("p",{hidden:0!==this.domWallet.Wallet.SlpCoins.size,children:"No BCH or SLP balance."}),Object(r.jsx)("div",{hidden:0===this.domWallet.Wallet.BchCoins.size&&0===this.domWallet.Wallet.SlpCoins.size,children:Object(r.jsxs)("button",{onClick:function(){return t.setState({showCoins:!t.state.showCoins})},children:[this.state.showCoins?"Hide":"Show"," UTXOs List"]})}),Object(r.jsx)("div",{hidden:!this.state.showCoins,children:Object(r.jsxs)("table",{style:C,children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"UTXO"}),Object(r.jsx)("th",{children:"Amount"}),Object(r.jsx)("th",{children:"Name"}),Object(r.jsx)("th",{children:"Type"})]})}),Object(r.jsxs)("tbody",{children:[Array.from(this.domWallet.Wallet.BchCoins).map((function(t){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:I.a.keyToOutpointString(t[0])}),Object(r.jsx)("td",{children:t[1].satoshis.div(Math.pow(10,8)).toFixed(8)}),Object(r.jsx)("td",{children:"BCH"})]},t[0])})),Array.from(this.domWallet.Wallet.SlpCoins).map((function(e){var n=Object(s.a)(e,2),a=n[0],i=n[1];return Array.from(i).map((function(e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:I.a.keyToOutpointString(e[0])}),Object(r.jsx)("td",{children:t.getSlpAmountString(e[1].amount,a)}),Object(r.jsx)("td",{children:t.getTokenName(a)}),Object(r.jsx)("td",{children:t.getTokenTypeString(a)})]},e[0])}))}))]})]})}),Object(r.jsx)("hr",{}),Object(r.jsx)("strong",{children:"Send"}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{htmlFor:"payto",children:"PayTo: "}),Object(r.jsx)("input",{className:"App-pay-to",id:"payto",value:this.state.outputAddressValue,placeholder:"bch"===this.state.selectedSlpTokenId?"cash or slp address":"slp address",onChange:this.updateOutputAddress}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{htmlFor:"coin",children:"Coin: "}),Object(r.jsxs)("select",{id:"coin",value:this.state.selectedSlpTokenId,onChange:this.updateSelectedToken,children:[Array.from(this.domWallet.Wallet.SlpCoins).map((function(e){var n=Object(s.a)(e,2),a=n[0];n[1];return Object(r.jsx)("option",{value:a,children:"SLP -> ".concat(t.getTokenName(a)," (").concat(t.getTokenTypeString(a),")")},a)})),Object(r.jsx)("option",{value:"bch",children:"Bitcoin Cash"},"bch")]}),"\xa0\xa0",Object(r.jsx)("label",{htmlFor:"amount",children:"Amount: "}),Object(r.jsx)("input",{className:"App-amount",id:"amount",value:this.state.outputAmountValue,placeholder:this.getTokenTicker(),onChange:this.updateOutputValue}),"\xa0\xa0",Object(r.jsx)("button",{onClick:this.setMaxAmount,children:"Max"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{onClick:this.addOutput,children:"Add Output"}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{hidden:0===this.state.txnValidationErrors.size,children:[Object(r.jsx)("br",{}),Object(r.jsx)("strong",{children:"Validation Errors"}),Object(r.jsx)("table",{style:C,children:Object(r.jsx)("tbody",{children:Array.from(this.state.txnValidationErrors).map((function(t,e){return Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:t})},e)}))})})]}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{hidden:0===this.state.currentTxn.Inputs.length,children:[Object(r.jsxs)("div",{hidden:!this.state.showTxnInputs,children:["Txn Inputs",Object(r.jsx)("table",{style:C,children:Object(r.jsx)("tbody",{children:Array.from(this.state.currentTxn.Inputs).map((function(e,n){var a=I.a.outpointToKey(e.prevTxId,e.outputIndex,!0),s=t.domWallet.Wallet.SlpOutpointCache.get(a);return s?Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:"".concat(e.prevTxId.toString("hex"),":").concat(e.outputIndex,", ").concat(t.getSlpAmountString(s.amount,s.tokenId)," ").concat(t.getTokenTicker(s.tokenId),", ").concat(s.satoshis," sats")})},n):Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:"".concat(e.prevTxId.toString("hex"),":").concat(e.outputIndex,", ").concat(e.output.satoshis," sats")})},n)}))})})]}),Object(r.jsxs)("button",{onClick:function(){return t.setState({showTxnInputs:!t.state.showTxnInputs})},children:[this.state.showTxnInputs?"Hide":"Show"," Transaction Inputs"]})]}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{hidden:0===this.state.currentTxn.Outputs.length,children:[Object(r.jsx)("strong",{children:"Txn Outputs"}),Object(r.jsx)("table",{style:C,children:Object(r.jsx)("tbody",{children:Array.from(this.state.currentTxn.Outputs).map((function(e,n){if(e[0].script.isDataOut())return Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:"SLP Metadata message, ".concat(e[0].script.toBuffer().length," bytes, ").concat(e[0].satoshis," sats")})},n);var a=t.state.currentTxn.SlpOutputs;return a.length>0&&n<=a.length?Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:"".concat(e[0].script.toAddress().toCashAddress(),", ").concat(t.getSlpAmountString(a[n-1])," ").concat(t.getTokenTicker(),", ").concat(e[0].satoshis," sats")})},n):Object(r.jsx)("tr",{children:Object(r.jsx)("td",{children:"".concat(e[0].script.toAddress().toCashAddress(),", ").concat(e[0].satoshis," sats")})},n)}))})}),Object(r.jsx)("br",{})]}),Object(r.jsxs)("div",{hidden:0===this.state.currentTxn.Outputs.length||0!==this.state.txnValidationErrors.size,children:[Object(r.jsx)("button",{onClick:this.sendTransaction,children:"Send"}),"\xa0\xa0",Object(r.jsx)("button",{onClick:this.clearTransaction,children:"Clear"})]}),Object(r.jsxs)("footer",{className:"App-footer",children:["Based on ",Object(r.jsx)("a",{href:"https://github.com/jcramer/bitcore-lib-fun",target:"_blank",rel:"noopener noreferrer",children:"bitcore-lib-fun"}),".\xa0\xa0 Sources on ",Object(r.jsx)("a",{href:"https://github.com/zh/spa-wallet",target:"_blank",rel:"noopener noreferrer",children:"Github"}),"."]})]})}},{key:"setState",value:function(t){var e=this;return new Promise((function(n){Object(h.a)(Object(p.a)(i.prototype),"setState",e).call(e,t,n)}))}},{key:"getTokenAmount",value:function(t,e){var n,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.domWallet.Wallet.TokenMetadata.get(e);if(s.hasType1())n=s.getType1().getDecimals();else if(s.hasNft1Group())n=s.getNft1Group().getDecimals();else{if(!s.hasNft1Child())throw Error("unknown token type");n=0}return a?t.div(Math.pow(10,n)):t.mul(Math.pow(10,n))}},{key:"getTokenTicker",value:function(e){if(e||(e=this.state.selectedSlpTokenId),"bch"===e)return"satoshis";if(!this.domWallet.Wallet.TokenMetadata.has(e))return"?";var n,a=this.domWallet.Wallet.TokenMetadata.get(e);if(a.hasType1())n=a.getType1().getTokenTicker_asU8();else if(a.hasNft1Group())n=a.getNft1Group().getTokenTicker_asU8();else{if(!a.hasNft1Child())throw Error("unknown token type");n=a.getNft1Child().getTokenTicker_asU8()}return t.from(n).toString("utf8")}},{key:"getTokenName",value:function(e){if("bch"===e)return"Bitcoin Cash";if(!this.domWallet.Wallet.TokenMetadata.has(e))return"".concat(e.slice(0,10),"...").concat(e.slice(54,64));var n,a=this.domWallet.Wallet.TokenMetadata.get(e);if(a.hasType1())n=a.getType1().getTokenName_asU8();else if(a.hasNft1Group())n=a.getNft1Group().getTokenName_asU8();else{if(!a.hasNft1Child())throw Error("unknown token type");n=a.getNft1Child().getTokenName_asU8()}return t.from(n).toString("utf8")}},{key:"getTokenTypeString",value:function(t){var e=this.domWallet.Wallet.TokenMetadata.get(t);if(!e)return"?";switch(e.getTypeMetadataCase()){case S.TokenMetadata.TypeMetadataCase.TYPE1:return"Token";case S.TokenMetadata.TypeMetadataCase.NFT1_GROUP:return"NFT Group";case S.TokenMetadata.TypeMetadataCase.NFT1_CHILD:return"NFT";default:return"?"}}},{key:"getSlpAmountString",value:function(t,e){e||(e=this.state.selectedSlpTokenId);var n,a=this.domWallet.Wallet.TokenMetadata.get(e);if(a.hasType1())n=a.getType1().getDecimals();else if(a.hasNft1Group())n=a.getNft1Group().getDecimals();else{if(!a.hasNft1Child())throw Error("unknown token type");n=0}return t.div(Math.pow(10,n)).toFixed()}}]),i}(x.Component);e.a=_}).call(this,n(2).Buffer)},196:function(t,e,n){"use strict";e.a=n.p+"static/media/logo.a5dd61ec.svg"},198:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a,s=n(18),r=n(16);a=Symbol.iterator;var i=function(){function t(e){Object(s.a)(this,t),this.set=new Set,this.list=[],this.maxSize=void 0,this.maxSize=e}return Object(r.a)(t,[{key:a,value:function(){return this.list.values()}},{key:"push",value:function(t){return this.set.add(t),this.maxSize>0&&this.set.size>this.maxSize&&this.shift(),this.list.push(t)}},{key:"has",value:function(t){return this.set.has(t)}},{key:"delete",value:function(t){this.set.delete(t)&&(this.list=this.list.filter((function(e){return e!==t})))}},{key:"toSet",value:function(){return this.set}},{key:"shift",value:function(){var t=this.list.shift();return t&&this.set.delete(t),t}},{key:"pop",value:function(){var t=this.list.pop();return t&&this.set.delete(t),t}},{key:"clear",value:function(){this.list=[],this.set.clear()}},{key:"length",get:function(){return this.list.length}}]),t}()},199:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return l}));var a=n(4),s=n.n(a),r=n(11),i=n(18),o=n(16),c=n(42),u=n(19),l=function(){function e(t){Object(i.a)(this,e),this.networkUrl=void 0,this.subscriptions={txn:!1,blockInfo:!1,blockData:!1},this.blockHeight=-1,this.networkUrl=t}return Object(o.a)(e,[{key:"SetUri",value:function(t){this.networkUrl=t}},{key:"SendTransaction",value:function(){var e=Object(r.a)(s.a.mark((function e(n,a){var r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new c.GrpcClient({url:this.networkUrl}),e.next=3,r.submitTransaction({txnHex:n});case 3:return i=e.sent,a&&a(),e.abrupt("return",t.from(i.getHash_asU8().reverse()).toString("hex"));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"GetTransaction",value:function(){var t=Object(r.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new c.GrpcClient({url:this.networkUrl}),t.next=3,n.getTransaction({hash:e,reversedHashOrder:!0});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"GetTokenMetadata",value:function(){var t=Object(r.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new c.GrpcClient({url:this.networkUrl}),t.next=3,n.getTokenMetadata(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"GetAddressTransactions",value:function(){var t=Object(r.a)(s.a.mark((function t(e,n){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new c.GrpcClient({url:this.networkUrl}),t.next=3,a.getBlockchainInfo();case 3:if(t.sent.getSlpIndex()){t.next=6;break}throw Error("connected bchd does not have slp index enabled");case 6:return t.next=8,a.getAddressTransactions({address:e});case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"Subscribe",value:function(){var t=Object(r.a)(s.a.mark((function t(e,n){var a,i,o,l=this;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=function(){var t=Object(r.a)(s.a.mark((function t(){var i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!l.subscriptions.txn){t.next=3;break}return console.log("Txn stream already connected"),t.abrupt("return");case 3:return i=new c.GrpcClient({url:l.networkUrl}),t.next=6,i.subscribeTransactions({includeMempoolAcceptance:!0,includeBlockAcceptance:!1,includeSerializedTxn:!1,addresses:e});case 6:(o=t.sent).on("end",function(){var t=Object(r.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.txn=!1;case 1:return t.next=4,u.a.sleep(500);case 4:return t.prev=4,console.log("[WALLET] trying to re-establish txn data stream..."),t.next=8,a();case 8:return t.abrupt("break",16);case 11:t.prev=11,t.t0=t.catch(4),console.log(t.t0);case 14:t.next=1;break;case 16:case"end":return t.stop()}}),t,null,[[4,11]])})));return function(e){return t.apply(this,arguments)}}()),o.on("data",function(){var t=Object(r.a)(s.a.mark((function t(e){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.txn=!0,a=e.getUnconfirmedTransaction().getTransaction(),n(a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),console.log("[WALLET] txn data stream established.");case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=3,a();case 3:return i=function(){var t=Object(r.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!l.subscriptions.blockData){t.next=3;break}return console.log("Txn stream already connected"),t.abrupt("return");case 3:return e=new c.GrpcClient({url:l.networkUrl}),t.next=6,e.subscribeBlocks({includeSerializedBlock:!0});case 6:(n=t.sent).on("end",function(){var t=Object(r.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.blockData=!1;case 1:return t.next=4,u.a.sleep(500);case 4:return t.prev=4,console.log("[WALLET] trying to re-establish block data stream..."),t.next=8,i();case 8:return t.abrupt("break",15);case 11:t.prev=11,t.t0=t.catch(4);case 13:t.next=1;break;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})));return function(e){return t.apply(this,arguments)}}()),n.on("data",function(){var t=Object(r.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.blockData=!0,console.log("BLOCK found");case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),console.log("[WALLET] block data stream established.");case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=6,i();case 6:return o=function(){var t=Object(r.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!l.subscriptions.blockInfo){t.next=3;break}return console.log("Txn stream already connected"),t.abrupt("return");case 3:return e=new c.GrpcClient({url:l.networkUrl}),t.next=6,e.subscribeBlocks();case 6:(n=t.sent).on("end",function(){var t=Object(r.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.blockInfo=!1;case 1:return t.next=4,u.a.sleep(500);case 4:return t.prev=4,console.log("[WALLET] trying to re-establish block info stream..."),t.next=8,o();case 8:return t.abrupt("break",15);case 11:t.prev=11,t.t0=t.catch(4);case 13:t.next=1;break;case 15:case"end":return t.stop()}}),t,null,[[4,11]])})));return function(e){return t.apply(this,arguments)}}()),n.on("data",function(){var t=Object(r.a)(s.a.mark((function t(e){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.subscriptions.blockInfo=!0,n=e.getBlockInfo().getHeight(),l.blockHeight=n,console.log("Block found: ".concat(n));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),console.log("[WALLET] block info stream established.");case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=9,o();case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}()}).call(this,n(2).Buffer)},203:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n(18),s=n(16),r=n(84),i=function(){function t(){Object(a.a)(this,t)}return Object(s.a)(t,[{key:"GetSeed",value:function(){return localStorage.getItem("bitcore-fun-seed")}},{key:"SetSeed",value:function(t){return localStorage.removeItem("bitcore-fun-wif"),localStorage.setItem("bitcore-fun-seed",t)}},{key:"GetWif",value:function(){return localStorage.getItem("bitcore-fun-wif")}},{key:"SetWif",value:function(t){return localStorage.removeItem("bitcore-fun-seed"),localStorage.setItem("bitcore-fun-wif",t)}},{key:"GetNode",value:function(){return localStorage.getItem("bitcore-fun-node")}},{key:"SetNode",value:function(t){return localStorage.removeItem("bitcore-fun-node"),localStorage.setItem("bitcore-fun-node",t)}},{key:"GetBlock",value:function(t){var e=localStorage.getItem(t);return e?parseInt(e,10):null}},{key:"SetBlock",value:function(t,e){return e||localStorage.removeItem(t),localStorage.setItem(t,e.toString())}}]),t}(),o=n(199),c=function(){function t(e,n,s){if(Object(a.a)(this,t),this.Ready=!1,this.Network=new o.a(Object({NODE_ENV:"production",PUBLIC_URL:"/spa-wallet",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_RPC_SERVER||"https://bchd.fountainhead.cash"),this.Wallet=void 0,this.Storage=new i,void 0===window)throw Error("access to 'window' is not available.");n&&(this.Storage=n),s&&(this.Network=s),this.Wallet=new r.a(this.Storage,this.Network,e)}return Object(s.a)(t,[{key:"setNode",value:function(t){this.Network.SetUri("https://".concat(t)),this.Storage.SetNode(t)}}]),t}()},204:function(t,e,n){"use strict";n.r(e),function(t){var e=n(0),a=n(1),s=n.n(a),r=n(58),i=n.n(r),o=(n(212),n(195));t.Buffer=n(2).Buffer,i.a.render(Object(e.jsx)(s.a.StrictMode,{children:Object(e.jsx)(o.a,{})}),document.getElementById("root"))}.call(this,n(12))},212:function(t,e,n){},214:function(t,e,n){},224:function(t,e){},226:function(t,e){},237:function(t,e){},239:function(t,e){},254:function(t,e){},260:function(t,e){},261:function(t,e){},298:function(t,e){},300:function(t,e){},305:function(t,e){},307:function(t,e){},319:function(t,e){},322:function(t,e){},352:function(t,e){},369:function(t,e){},371:function(t,e){},59:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return O}));var a,s=n(32),r=n(4),i=n.n(r),o=n(11),c=n(51),u=n(18),l=n(16),d=n(9),h=n.n(d),p=n(8),f=n(60),b=n(84),x=n(19),m=546;!function(t){t[t.TokenVersionType1=1]="TokenVersionType1",t[t.TokenVersionType1_NFT_Child=65]="TokenVersionType1_NFT_Child",t[t.TokenVersionType1_NFT_Group=129]="TokenVersionType1_NFT_Group"}(a||(a={}));var O=function(){function e(t){Object(u.a)(this,e),this.wallet=void 0,this.txn=new p.Transaction,this.tokenId="bch",this.slpOpreturnMessage=void 0,this.slpChangeAmt=void 0,this.slpOutputs=new Array,this.wallet=t}return Object(l.a)(e,[{key:"TokenId",get:function(){return this.tokenId}},{key:"SlpOutputs",get:function(){return this.slpChangeAmt?[].concat(Object(c.a)(this.slpOutputs),[this.slpChangeAmt.amount]):Object(c.a)(this.slpOutputs)}},{key:"SlpChangeOutput",get:function(){return this.slpChangeAmt?{amount:this.slpChangeAmt.amount,index:this.slpChangeAmt.index}:null}},{key:"BchChangeOutput",get:function(){if(!this.txn._changeIndex)return null;var t=this.txn._changeIndex;return{amount:this.txn.outputs[t].satoshis,index:t}}},{key:"Inputs",get:function(){return Object(c.a)(this.txn.inputs)}},{key:"Outputs",get:function(){var t=this;return this.txn.outputs.map((function(e,n){var a=h()(0);if(n>0&&n-1<t.slpOutputs.length)a.add(t.slpOutputs[n-1]);else if(t.slpChangeAmt&&n===t.slpOutputs.length+1&&(a.add(t.slpChangeAmt.amount),t.slpChangeAmt.index!==n))throw Error("slp change has wrong index");return[e,a]}))}}]),Object(l.a)(e,[{key:"AddSlpOutput",value:function(t,e,n){if(this.tokenId!==n&&(this.slpOutputs=[],this.tokenId=n),"bch"===n)throw Error("can't add slp token with bch token id");this.txn._changeScript=void 0,void 0!==this.txn._changeIndex&&(this.txn.removeOutput(this.txn._changeIndex),this.txn._changeIndex=void 0),this.slpChangeAmt&&(this.txn.removeOutput(this.slpChangeAmt.index),this.slpChangeAmt=void 0);var a=this.slpOutputs.length+1;this.txn.addOutput(new p.Transaction.Output({script:new p.Script(new p.Address(t)),satoshis:m}),a),this.slpOutputs.push(e),this.addSlpInputs(n),this.addBchInputs()}},{key:"AddBchOutput",value:function(t,e){return this.txn.to(t,e),this.addBchInputs()}},{key:"SignTransaction",value:function(){var t=Object(o.a)(i.a.mark((function t(e){var n,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,this.txn.sign(n),a=this.txn.serialize(),s=this.txn.inputAmount-this.txn.outputAmount,t.abrupt("return",{txnHex:a,fee:s,sendAmount:this.txn.outputAmount});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addBchInputs",value:function(){var e=this;this.txn.change(this.wallet.Address.toCashAddress());var n,a=function(){e.txn.feePerByte(1);var t=b.a.GetFeeRate(e.txn);return e.txn.inputAmount>=e.txn.outputAmount&&t>=1},r=Array.from(this.wallet.BchCoins).sort((function(t,e){return t[1].satoshis.sub(e[1].satoshis).toNumber()})),i=Object(s.a)(r);try{for(i.s();!(n=i.n()).done;){var o,c=n.value,u=!1,l=c[0].slice(0,64),d=t.from(c[0].slice(64),"hex").readUInt32BE(0),h=Object(s.a)(this.txn.inputs);try{for(h.s();!(o=h.n()).done;){var f=o.value;if(l===f.prevTxId.toString("hex")&&d===f.outputIndex){u=!0;break}}}catch(x){h.e(x)}finally{h.f()}if(!u){if(this.txn.outputs.length>0&&a())return!0;this.txn.addInput(new p.Transaction.Input.PublicKeyHash({output:new p.Transaction.Output({script:p.Script.buildPublicKeyHashOut(c[1].address),satoshis:c[1].satoshis.toNumber()}),prevTxId:t.from(l,"hex"),outputIndex:d,script:p.Script.empty()})),this.txn.feePerByte(1)}}}catch(x){i.e(x)}finally{i.f()}return a()}},{key:"createMd",value:function(t,e){var n=e.map((function(t){return new f.BN(t.toFixed())}));switch(this.wallet.TokenMetadata.get(t).getTokenType()){case a.TokenVersionType1:return f.TokenType1.send(t,n);case a.TokenVersionType1_NFT_Group:return f.NFT1.Group.send(t,n);case a.TokenVersionType1_NFT_Child:return f.NFT1.Child.send(t,[new f.BN(1)])}}},{key:"addSlpInputs",value:function(e){var n,a=this,r=Array.from(this.wallet.SlpCoins.get(e)).sort((function(t,e){return t[1].amount.sub(e[1].amount).toNumber()})),i=function(){a.slpChangeAmt&&(a.txn.removeOutput(a.slpChangeAmt.index),a.slpChangeAmt=void 0);var t=a.txn.inputs.reduce((function(t,n,s){var r=a.wallet.SlpCoins.get(e);if(!r)return h()(0);var i=x.a.outpointToKey(a.txn.inputs[s].prevTxId,a.txn.inputs[s].outputIndex,!0);return r.has(i)?t.add(r.get(i).amount):t}),h()(0)),n=a.slpOutputs.reduce((function(t,e,n){return t.add(e)}),h()(0));if(t.gt(n)&&(a.slpChangeAmt={amount:t.minus(n),index:a.slpOutputs.length+1},a.txn.addOutput(new p.Transaction.Output({script:new p.Script(a.wallet.Address),satoshis:m}),a.slpChangeAmt.index)),t.gte(n)){a.slpOpreturnMessage&&a.txn.removeOutput(0);var s=a.SlpChangeOutput?[].concat(Object(c.a)(a.slpOutputs),[a.slpChangeAmt.amount]):a.slpOutputs;return a.slpOpreturnMessage=a.createMd(e,s),a.txn.addOutput(new p.Transaction.Output({script:a.slpOpreturnMessage,satoshis:0}),0),!0}return!1},o=Object(s.a)(r);try{for(o.s();!(n=o.n()).done;){var u,l=n.value,d=!1,f=l[0].slice(0,64),b=t.from(l[0].slice(64),"hex").readUInt32BE(0),O=Object(s.a)(this.txn.inputs);try{for(O.s();!(u=O.n()).done;){var g=u.value;if(f===g.prevTxId.toString("hex")&&b===g.outputIndex){d=!0;break}}}catch(j){O.e(j)}finally{O.f()}if(!d){if(this.slpOutputs.length>0&&i())return!0;this.wallet.SlpOutpointCache.set(l[0],{amount:l[1].amount,satoshis:l[1].satoshis,address:l[1].address,tokenId:e}),this.txn.addInput(new p.Transaction.Input.PublicKeyHash({output:new p.Transaction.Output({script:p.Script.buildPublicKeyHashOut(l[1].address),satoshis:l[1].satoshis.toNumber()}),prevTxId:t.from(f,"hex"),outputIndex:b,script:p.Script.empty()}))}}}catch(j){o.e(j)}finally{o.f()}return i()}}]),e}()}).call(this,n(2).Buffer)},84:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return O}));var a=n(51),s=n(32),r=n(4),i=n.n(r),o=n(11),c=n(18),u=n(16),l=n(9),d=n(61),h=n(33),p=n(8),f=n(198),b=n(19),x=new f.a(1e5),m="m/44'/245'/0'/0/0",O=function(){function e(t,n,a){var s=this;if(Object(c.a)(this,e),this.SlpOutpointCache=new Map,this.storage=void 0,this.network=void 0,this.parent=void 0,this.mnemonic=void 0,this.privateKey=void 0,this.bchTxi=new Map,this.bchTxo=new Map,this.slpTxi=new Map,this.slpTxo=new Map,this.tokenMetadata=new Map,this.updateParent=function(){s.parent&&s.parent.UpdateWalletUI()},this.storage=t,this.network=n,this.parent=a,this.storage.GetWif())this.privateKey=new p.PrivateKey(this.storage.GetWif());else{this.mnemonic=h.generateMnemonic();var r=d.fromSeed(h.mnemonicToSeedSync(this.mnemonic)),i=r.derivePath(m);this.privateKey=new p.PrivateKey(i.toWIF()),null===this.storage.GetSeed()?this.storage.SetSeed(this.mnemonic):(this.mnemonic=this.storage.GetSeed(),i=(r=d.fromSeed(h.mnemonicToSeedSync(this.mnemonic))).derivePath(m),this.privateKey=new p.PrivateKey(i.toWIF()))}}return Object(u.a)(e,null,[{key:"EstimateTxnSize",value:function(t){return t._estimateSize()}},{key:"GetFeeRate",value:function(t){var n=e.EstimateTxnSize(t);console.log("estimated size: ".concat(n));var a=t.inputAmount-t.outputAmount;if(!a||a<0)return 0;var s=a/n;return console.log("estimated fee rate: ".concat(s)),s}}]),Object(u.a)(e,[{key:"isMine",value:function(t){return t===this.Address.toCashAddress()}},{key:"GetChangeOutput",value:function(t){var e=this,n=[];return t.outputs.forEach((function(t){e.isMine(t.script.toAddress().toCashAddress())&&n.push(t)})),n}},{key:"LoadInitialBalances",value:function(){var t=Object(o.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.bchTxi=new Map,this.bchTxo=new Map,this.slpTxi=new Map,this.slpTxo=new Map,t.next=6,this.network.GetAddressTransactions(this.Address.toCashAddress());case 6:return e=t.sent,t.next=9,this.indexTransactionIO(e.getConfirmedTransactionsList());case 9:return t.next=11,this.indexTransactionIO(e.getUnconfirmedTransactionsList().map((function(t){return t.getTransaction()})));case 11:this.updateParent();case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"UpdateMnemonic",value:function(t){if(h.validateMnemonic(t)){this.mnemonic=t,this.storage.SetSeed(this.mnemonic),localStorage.setItem("bitcore-fun-seed",this.mnemonic);var e=d.fromSeed(h.mnemonicToSeedSync(this.mnemonic)).derivePath(m);this.privateKey=new p.PrivateKey(e.toWIF())}else try{p.PrivateKey._transformWIF(t),this.privateKey=p.PrivateKey.fromWIF(t),this.mnemonic=void 0,this.storage.SetWif(t)}catch(n){throw Error("invalid mnemonic and invalid wif")}this.LoadInitialBalances()}},{key:"GetBchBalance",value:function(){var t=Array.from(this.bchTxi).reduce((function(t,e){return t.add(e[1].satoshis)}),Object(l.Big)(0));return Array.from(this.bchTxo).reduce((function(t,e){return t.add(e[1].satoshis)}),Object(l.Big)(0)).sub(t)}},{key:"GetSlpBalances",value:function(){var t=new Map;return Array.from(this.slpTxi).forEach((function(e){t.set(e[0],Array.from(e[1]).reduce((function(t,e){return t.add(e[1].amount)}),Object(l.Big)(0)))})),Array.from(this.slpTxo).forEach((function(e){var n=t.get(e[0]);n||(n=Object(l.Big)(0));var a=Array.from(e[1]).reduce((function(t,e){return t.add(e[1].amount)}),Object(l.Big)(0));t.set(e[0],a.sub(n))})),t}},{key:"Subscribe",value:function(){var t=this;this.network.Subscribe([this.Address.toCashAddress()],(function(e){t.processNewTransaction(e)}))}},{key:"processNewTransaction",value:function(){var t=Object(o.a)(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=b.a.hashToTxid(e.getHash_asU8()),!x.has(n)){t.next=3;break}return t.abrupt("return");case 3:return x.push(n),console.log("".concat(n)),t.next=7,this.indexTransactionIO([e]);case 7:this.updateParent();case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"SendTransaction",value:function(){var t=Object(o.a)(i.a.mark((function t(e){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.SendTransaction(e);case 2:return n=t.sent,t.next=5,this.network.GetTransaction(n);case 5:return a=t.sent,this.processNewTransaction(a.getTransaction()),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"indexTransactionIO",value:function(){var e=Object(o.a)(i.a.mark((function e(n){var r,o,c,u,d,h,f,x,m,O,g,j,v,T,k=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Set,o=Object(s.a)(n),e.prev=2,o.s();case 4:if((c=o.n()).done){e.next=46;break}u=c.value,d=Object(s.a)(u.getInputsList()),e.prev=7,d.s();case 9:if((h=d.n()).done){e.next=17;break}if(f=h.value,this.Address.toCashAddress().includes(f.getAddress())){e.next=13;break}return e.abrupt("continue",15);case 13:x=b.a.outpointToKey(f.getOutpoint().getHash_asU8(),f.getOutpoint().getIndex()),f.hasSlpToken()?(m=t.from(f.getSlpToken().getTokenId_asU8()).toString("hex"),r.add(m),this.slpTxi.has(m)||this.slpTxi.set(m,new Map),this.slpTxi.get(m).set(x,{amount:Object(l.Big)(f.getSlpToken().getAmount()),address:new p.Address(f.getAddress()),satoshis:Object(l.Big)(f.getValue())})):this.bchTxi.set(x,{satoshis:Object(l.Big)(f.getValue()),address:new p.Address(f.getAddress())});case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),d.e(e.t0);case 22:return e.prev=22,d.f(),e.finish(22);case 25:O=Object(s.a)(u.getOutputsList()),e.prev=26,O.s();case 28:if((g=O.n()).done){e.next=36;break}if((j=g.value).getAddress()&&this.Address.toCashAddress().includes(j.getAddress())){e.next=32;break}return e.abrupt("continue",34);case 32:v=b.a.outpointToKey(u.getHash_asU8(),j.getIndex()),j.hasSlpToken()?(T=t.from(j.getSlpToken().getTokenId_asU8()).toString("hex"),r.add(T),this.slpTxo.has(T)||this.slpTxo.set(T,new Map),this.slpTxo.get(T).set(v,{amount:Object(l.Big)(j.getSlpToken().getAmount()),address:new p.Address(j.getAddress()),satoshis:Object(l.Big)(j.getValue())})):this.bchTxo.set(v,{satoshis:Object(l.Big)(j.getValue()),address:new p.Address(j.getAddress())});case 34:e.next=28;break;case 36:e.next=41;break;case 38:e.prev=38,e.t1=e.catch(26),O.e(e.t1);case 41:return e.prev=41,O.f(),e.finish(41);case 44:e.next=4;break;case 46:e.next=51;break;case 48:e.prev=48,e.t2=e.catch(2),o.e(e.t2);case 51:return e.prev=51,o.f(),e.finish(51);case 54:return e.next=56,this.network.GetTokenMetadata(Object(a.a)(r.keys()));case 56:e.sent.getTokenMetadataList().forEach((function(e){return k.tokenMetadata.set(t.from(e.getTokenId_asU8()).toString("hex"),e)}));case 58:case"end":return e.stop()}}),e,this,[[2,48,51,54],[7,19,22,25],[26,38,41,44]])})));return function(t){return e.apply(this,arguments)}}()},{key:"Mnemonic",get:function(){return this.mnemonic}},{key:"Wif",get:function(){return this.mnemonic?null:this.privateKey.toWIF()}},{key:"XPub",get:function(){return this.Mnemonic?d.fromSeed(h.mnemonicToSeedSync(this.Mnemonic)).neutered().toBase58():null}},{key:"PrivateKey",get:function(){return this.privateKey.toWIF()},set:function(t){if(h.validateMnemonic(t)){var e=d.fromSeed(h.mnemonicToSeedSync(this.mnemonic)).derivePath(m);this.privateKey=new p.PrivateKey(e.toWIF())}else try{this.privateKey=new p.PrivateKey(t)}catch(n){throw Error("invalid mnemonic and invalid wif")}this.LoadInitialBalances()}},{key:"Address",get:function(){return this.privateKey.toAddress()}},{key:"BchCoins",get:function(){var t=this,e=new Map;return this.bchTxo.forEach((function(n,a){e.set(a,n),t.bchTxi.has(a)&&e.delete(a)})),e}},{key:"SlpCoins",get:function(){var t=this,e=new Map;return this.slpTxo.forEach((function(n,a){var s;if(!e.has(a)){var r=new Map;e.set(a,r)}s=e.get(a);var i=t.slpTxi.get(a);n.forEach((function(e,n){s.set(n,e),t.SlpOutpointCache.has(n)||t.SlpOutpointCache.set(n,{amount:e.amount,satoshis:e.satoshis,address:e.address,tokenId:a}),i&&i.has(n)&&s.delete(n)}))})),e}},{key:"TokenMetadata",get:function(){return this.tokenMetadata}}]),e}()}).call(this,n(2).Buffer)}},[[204,1,2]]]);
//# sourceMappingURL=main.726bad09.chunk.js.map